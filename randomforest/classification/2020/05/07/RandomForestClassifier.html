<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Random Forest Classifier | Isaac’s Blog</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Random Forest Classifier" />
<meta name="author" content="Isaac Flath" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The basics of building a decent classifier on tabular data" />
<meta property="og:description" content="The basics of building a decent classifier on tabular data" />
<link rel="canonical" href="https://isaac-flath.github.io/blog/randomforest/classification/2020/05/07/RandomForestClassifier.html" />
<meta property="og:url" content="https://isaac-flath.github.io/blog/randomforest/classification/2020/05/07/RandomForestClassifier.html" />
<meta property="og:site_name" content="Isaac’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-07T00:00:00-05:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Isaac Flath"},"description":"The basics of building a decent classifier on tabular data","mainEntityOfPage":{"@type":"WebPage","@id":"https://isaac-flath.github.io/blog/randomforest/classification/2020/05/07/RandomForestClassifier.html"},"@type":"BlogPosting","url":"https://isaac-flath.github.io/blog/randomforest/classification/2020/05/07/RandomForestClassifier.html","headline":"Random Forest Classifier","dateModified":"2020-05-07T00:00:00-05:00","datePublished":"2020-05-07T00:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://isaac-flath.github.io/blog/feed.xml" title="Isaac's Blog" /><link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Random Forest Classifier | Isaac’s Blog</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Random Forest Classifier" />
<meta name="author" content="Isaac Flath" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The basics of building a decent classifier on tabular data" />
<meta property="og:description" content="The basics of building a decent classifier on tabular data" />
<link rel="canonical" href="https://isaac-flath.github.io/blog/randomforest/classification/2020/05/07/RandomForestClassifier.html" />
<meta property="og:url" content="https://isaac-flath.github.io/blog/randomforest/classification/2020/05/07/RandomForestClassifier.html" />
<meta property="og:site_name" content="Isaac’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-07T00:00:00-05:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Isaac Flath"},"description":"The basics of building a decent classifier on tabular data","mainEntityOfPage":{"@type":"WebPage","@id":"https://isaac-flath.github.io/blog/randomforest/classification/2020/05/07/RandomForestClassifier.html"},"@type":"BlogPosting","url":"https://isaac-flath.github.io/blog/randomforest/classification/2020/05/07/RandomForestClassifier.html","headline":"Random Forest Classifier","dateModified":"2020-05-07T00:00:00-05:00","datePublished":"2020-05-07T00:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://isaac-flath.github.io/blog/feed.xml" title="Isaac's Blog" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
<script type="text/javascript">
require.config({
  paths: {
    jquery: 'https://code.jquery.com/jquery-3.5.0.min',
    plotly: 'https://cdn.plot.ly/plotly-latest.min'
  },

  shim: {
    plotly: {
      deps: ['jquery'],
      exports: 'plotly'
    }
  }
});
</script>

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Isaac&#39;s Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About Me</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Random Forest Classifier</h1><p class="page-description">The basics of building a decent classifier on tabular data</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-05-07T00:00:00-05:00" itemprop="datePublished">
        May 7, 2020
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Isaac Flath</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      9 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#RandomForest">RandomForest</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#Classification">Classification</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/Isaac-Flath/blog/tree/master/_notebooks/RandomForestClassifier.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/Isaac-Flath/blog/master?filepath=_notebooks%2FRandomForestClassifier.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/Isaac-Flath/blog/blob/master/_notebooks/RandomForestClassifier.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#Goal">Goal </a></li>
<li class="toc-entry toc-h1"><a href="#Setup">Setup </a></li>
<li class="toc-entry toc-h1"><a href="#Data-Setup">Data Setup </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Dependent-Variable">Dependent Variable </a></li>
<li class="toc-entry toc-h3"><a href="#Training-and-Validation-Set-Split">Training and Validation Set Split </a></li>
<li class="toc-entry toc-h3"><a href="#Dates">Dates </a></li>
<li class="toc-entry toc-h3"><a href="#Categorical-Variables">Categorical Variables </a>
<ul>
<li class="toc-entry toc-h5"><a href="#Ordinal-Categorical-Variables">Ordinal Categorical Variables </a></li>
<li class="toc-entry toc-h5"><a href="#Categorical-Variables-Final">Categorical Variables Final </a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#Final-Change">Final Change </a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#Random-Forest-Model">Random Forest Model </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Initial-Model">Initial Model </a></li>
<li class="toc-entry toc-h3"><a href="#Model-Tuning---Grid-Search">Model Tuning - Grid Search </a></li>
<li class="toc-entry toc-h3"><a href="#Results">Results </a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#Model-Minimizing">Model Minimizing </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Feature-Importance">Feature Importance </a></li>
<li class="toc-entry toc-h3"><a href="#Remove-Low-Important-Variables">Remove Low Important Variables </a></li>
<li class="toc-entry toc-h3"><a href="#Results">Results </a></li>
<li class="toc-entry toc-h3"><a href="#Redundant-columns">Redundant columns </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/RandomForestClassifier.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Goal">
<a class="anchor" href="#Goal" aria-hidden="true"><span class="octicon octicon-link"></span></a>Goal<a class="anchor-link" href="#Goal"> </a>
</h1>
<p>The goal is to predict whether a passenger on the titanic survived or not.  The applications for binary classification are endless and could be applied to many real world problems.  Does this patient have this disease?  Will this customer Churn?  These are just a few examples.</p>
<p>The purpose is to give a general guide to classification.  If you get trhrough this and want more detail, I highly recomend checking out the Tabular Chapter of Deep Learning for Coders with fastai &amp; Pytorch by Jeremy Howard and Sylvain Gugger.  The book primarily focuses on deep learning, though decision trees are covered for tabular data.  All of the material in this guide and more is covered in much greater detail in that book.</p>
<p><a href="https://www.amazon.com/Deep-Learning-Coders-fastai-PyTorch/dp/1492045527">https://www.amazon.com/Deep-Learning-Coders-fastai-PyTorch/dp/1492045527</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Setup">
<a class="anchor" href="#Setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setup<a class="anchor-link" href="#Setup"> </a>
</h1>
<p>We are going to start with loading libraries and datasets that are needed.  I am going to skip over this as they are pretty self explanatory, but feel free to look close if you would like.</p>
<p>I am going to use Seaborn to load the titanic dataset.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse-hide</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">fastai2.tabular.all</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fastai2</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">dtreeviz.trees</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">scipy.cluster</span> <span class="kn">import</span> <span class="n">hierarchy</span> <span class="k">as</span> <span class="n">hc</span>


<span class="n">df</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s1">'titanic'</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>survived</th>
      <th>pclass</th>
      <th>sex</th>
      <th>age</th>
      <th>sibsp</th>
      <th>parch</th>
      <th>fare</th>
      <th>embarked</th>
      <th>class</th>
      <th>who</th>
      <th>adult_male</th>
      <th>deck</th>
      <th>embark_town</th>
      <th>alive</th>
      <th>alone</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>male</td>
      <td>22.0</td>
      <td>1</td>
      <td>0</td>
      <td>7.2500</td>
      <td>S</td>
      <td>Third</td>
      <td>man</td>
      <td>True</td>
      <td>NaN</td>
      <td>Southampton</td>
      <td>no</td>
      <td>False</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>female</td>
      <td>38.0</td>
      <td>1</td>
      <td>0</td>
      <td>71.2833</td>
      <td>C</td>
      <td>First</td>
      <td>woman</td>
      <td>False</td>
      <td>C</td>
      <td>Cherbourg</td>
      <td>yes</td>
      <td>False</td>
    </tr>
    <tr>
      <td>2</td>
      <td>1</td>
      <td>3</td>
      <td>female</td>
      <td>26.0</td>
      <td>0</td>
      <td>0</td>
      <td>7.9250</td>
      <td>S</td>
      <td>Third</td>
      <td>woman</td>
      <td>False</td>
      <td>NaN</td>
      <td>Southampton</td>
      <td>yes</td>
      <td>True</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>female</td>
      <td>35.0</td>
      <td>1</td>
      <td>0</td>
      <td>53.1000</td>
      <td>S</td>
      <td>First</td>
      <td>woman</td>
      <td>False</td>
      <td>C</td>
      <td>Southampton</td>
      <td>yes</td>
      <td>False</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0</td>
      <td>3</td>
      <td>male</td>
      <td>35.0</td>
      <td>0</td>
      <td>0</td>
      <td>8.0500</td>
      <td>S</td>
      <td>Third</td>
      <td>man</td>
      <td>True</td>
      <td>NaN</td>
      <td>Southampton</td>
      <td>no</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Data-Setup">
<a class="anchor" href="#Data-Setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data Setup<a class="anchor-link" href="#Data-Setup"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Dependent-Variable">
<a class="anchor" href="#Dependent-Variable" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dependent Variable<a class="anchor-link" href="#Dependent-Variable"> </a>
</h3>
<p>We want to define what we are predicting, or the dependent variable.  We also see that 'Survived' and 'alive' columns are the same thing with different names.  We need to get rid of one and predict the other.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># survived is a duplicate of alive, so get rid of it</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">'survived'</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">dep_var</span> <span class="o">=</span> <span class="s1">'alive'</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Training-and-Validation-Set-Split">
<a class="anchor" href="#Training-and-Validation-Set-Split" aria-hidden="true"><span class="octicon octicon-link"></span></a>Training and Validation Set Split<a class="anchor-link" href="#Training-and-Validation-Set-Split"> </a>
</h3>
<p>Best practice is to minimally have a training and validation set.  Those are the 2 that we will use for this tutorial.</p>
<ul>
<li>Training Set:  This is what the model actually trains on</li>
<li>Validation Set:  This is used to gauge success of the Training</li>
<li>Test Set:  This is a held out of the total process to be an additional safeguard against overfitting</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span><span class="o">&gt;.</span><span class="mi">2</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cond</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">cond</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">splits</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">train</span><span class="p">),</span><span class="nb">list</span><span class="p">(</span><span class="n">valid</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Dates">
<a class="anchor" href="#Dates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dates<a class="anchor-link" href="#Dates"> </a>
</h3>
<p>We don't have any dates to deal with, but if we did we would do the following:</p>
<p><code>df = add_datepart(df,'date')</code></p>
<p>This would replace that date with a ton of different columns, such as the year, the day number, the day of the week, is it month end, is it month start, and more.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Categorical-Variables">
<a class="anchor" href="#Categorical-Variables" aria-hidden="true"><span class="octicon octicon-link"></span></a>Categorical Variables<a class="anchor-link" href="#Categorical-Variables"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Ordinal-Categorical-Variables">
<a class="anchor" href="#Ordinal-Categorical-Variables" aria-hidden="true"><span class="octicon octicon-link"></span></a>Ordinal Categorical Variables<a class="anchor-link" href="#Ordinal-Categorical-Variables"> </a>
</h5>
<p>Some categorical variables have a natural heirarchy.  By telling pandas the order it tends to mean trees don't have to split as many times, which speeds up training times.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">'class'</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[Third, First, Second]
Categories (3, object): [Third, First, Second]</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">classes</span> <span class="o">=</span> <span class="s1">'First'</span><span class="p">,</span><span class="s1">'Second'</span><span class="p">,</span><span class="s1">'Third'</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">'class'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'class'</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'category'</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'class'</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">set_categories</span><span class="p">(</span><span class="n">classes</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Categorical-Variables-Final">
<a class="anchor" href="#Categorical-Variables-Final" aria-hidden="true"><span class="octicon octicon-link"></span></a>Categorical Variables Final<a class="anchor-link" href="#Categorical-Variables-Final"> </a>
</h5>
<p>We are not going to do some data cleaning.  The Categorify and FillMissing functions in the fastai2 library make this easy.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">procs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Categorify</span><span class="p">,</span> <span class="n">FillMissing</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cont</span><span class="p">,</span><span class="n">cat</span> <span class="o">=</span> <span class="n">cont_cat_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dep_var</span><span class="o">=</span><span class="n">dep_var</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to</span> <span class="o">=</span> <span class="n">TabularPandas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">procs</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="n">cont</span><span class="p">,</span> <span class="n">y_names</span><span class="o">=</span><span class="n">dep_var</span><span class="p">,</span> <span class="n">splits</span><span class="o">=</span><span class="n">splits</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's take a look at the traiing and validation sets and make sure we have a good split of each.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">train</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">valid</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(710, 181)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can now take a look and see that while we see all the same data, behind the scenes it is all numeric.  This is exactly what we need for our random forest.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sex</th>
      <th>embarked</th>
      <th>class</th>
      <th>who</th>
      <th>adult_male</th>
      <th>deck</th>
      <th>embark_town</th>
      <th>alone</th>
      <th>age_na</th>
      <th>pclass</th>
      <th>age</th>
      <th>sibsp</th>
      <th>parch</th>
      <th>fare</th>
      <th>alive</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>male</td>
      <td>S</td>
      <td>Third</td>
      <td>man</td>
      <td>True</td>
      <td>#na#</td>
      <td>Southampton</td>
      <td>False</td>
      <td>False</td>
      <td>3.0</td>
      <td>22.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>7.250000</td>
      <td>no</td>
    </tr>
    <tr>
      <th>1</th>
      <td>female</td>
      <td>C</td>
      <td>First</td>
      <td>woman</td>
      <td>False</td>
      <td>C</td>
      <td>Cherbourg</td>
      <td>False</td>
      <td>False</td>
      <td>1.0</td>
      <td>38.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>71.283302</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>2</th>
      <td>female</td>
      <td>S</td>
      <td>Third</td>
      <td>woman</td>
      <td>False</td>
      <td>#na#</td>
      <td>Southampton</td>
      <td>True</td>
      <td>False</td>
      <td>3.0</td>
      <td>26.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>7.925000</td>
      <td>yes</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pclass</th>
      <th>sex</th>
      <th>age</th>
      <th>sibsp</th>
      <th>parch</th>
      <th>fare</th>
      <th>embarked</th>
      <th>class</th>
      <th>who</th>
      <th>adult_male</th>
      <th>deck</th>
      <th>embark_town</th>
      <th>alive</th>
      <th>alone</th>
      <th>age_na</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>3.0</td>
      <td>2</td>
      <td>22.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>7.250000</td>
      <td>3</td>
      <td>3</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1.0</td>
      <td>1</td>
      <td>38.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>71.283302</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <td>2</td>
      <td>3.0</td>
      <td>1</td>
      <td>26.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>7.925000</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Final-Change">
<a class="anchor" href="#Final-Change" aria-hidden="true"><span class="octicon octicon-link"></span></a>Final Change<a class="anchor-link" href="#Final-Change"> </a>
</h3>
<p>Finally, we will put just the data in xs and ys so they are in easy format to pass to models.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xs</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">xs</span><span class="p">,</span><span class="n">to</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">y</span>
<span class="n">valid_xs</span><span class="p">,</span><span class="n">valid_y</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">xs</span><span class="p">,</span><span class="n">to</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">y</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Random-Forest-Model">
<a class="anchor" href="#Random-Forest-Model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Random Forest Model<a class="anchor-link" href="#Random-Forest-Model"> </a>
</h1>
<h3 id="Initial-Model">
<a class="anchor" href="#Initial-Model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Initial Model<a class="anchor-link" href="#Initial-Model"> </a>
</h3>
<p>Let's start by creating a model without tuning and see how it does</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">m</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">xs</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[441,   1],
       [  5, 263]])</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Looking pretty good!  Only 7 wrong.  Let's see how it did on the validation set.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">valid_y</span><span class="p">,</span><span class="n">m</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">valid_xs</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[94, 13],
       [24, 50]])</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Still way better than 50/50, but not quite as good.  This is because the model did not train based on this validation data so it doesn't perform nearly as well.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Model-Tuning---Grid-Search">
<a class="anchor" href="#Model-Tuning---Grid-Search" aria-hidden="true"><span class="octicon octicon-link"></span></a>Model Tuning - Grid Search<a class="anchor-link" href="#Model-Tuning---Grid-Search"> </a>
</h3>
<p>We made our first model, and it doesn't seem to predict as well as we would like.  Let's do something about that.</p>
<p>We are going to do a grid search.  There are many more sophisticated ways to find parameters (maybe a future post), but the grid search is easy to understand.  Basically you pick some ranges, and you try them all to see what works best.</p>
<p>We will use the built in gridsearch.  All we need to do is define the range of parameters, and let it find the best model.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'n_estimators'</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span> 
              <span class="s1">'max_depth'</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
              <span class="s1">'min_samples_split'</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
              <span class="s1">'max_features'</span><span class="p">:[</span><span class="s1">'auto'</span><span class="p">,</span><span class="s1">'log2'</span><span class="p">]}</span>             
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clf</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">RandomForestClassifier</span><span class="p">(),</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/Users/isaac.flath/opt/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:1978: FutureWarning: The default value of cv will change from 3 to 5 in version 0.22. Specify it explicitly to silence this warning.
  warnings.warn(CV_WARNING, FutureWarning)
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>GridSearchCV(cv='warn', error_score='raise-deprecating',
             estimator=RandomForestClassifier(bootstrap=True, class_weight=None,
                                              criterion='gini', max_depth=None,
                                              max_features='auto',
                                              max_leaf_nodes=None,
                                              min_impurity_decrease=0.0,
                                              min_impurity_split=None,
                                              min_samples_leaf=1,
                                              min_samples_split=2,
                                              min_weight_fraction_leaf=0.0,
                                              n_estimators='warn', n_jobs=None,
                                              oob_score=False,
                                              random_state=None, verbose=0,
                                              warm_start=False),
             iid='warn', n_jobs=-1,
             param_grid={'max_depth': range(10, 20, 20),
                         'max_features': ['auto', 'log2'],
                         'min_samples_split': range(2, 20),
                         'n_estimators': range(10, 20, 20)},
             pre_dispatch='2*n_jobs', refit=True, return_train_score=False,
             scoring=None, verbose=0)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Results">
<a class="anchor" href="#Results" aria-hidden="true"><span class="octicon octicon-link"></span></a>Results<a class="anchor-link" href="#Results"> </a>
</h3>
<p>We can see below that the best esimator works better for prediciton the validation set than the model above did.  Success!</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">clf</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">xs</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[419,  23],
       [ 62, 206]])</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">valid_y</span><span class="p">,</span><span class="n">clf</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">valid_xs</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[100,   7],
       [ 28,  46]])</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Model-Minimizing">
<a class="anchor" href="#Model-Minimizing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Model Minimizing<a class="anchor-link" href="#Model-Minimizing"> </a>
</h1>
<p>Now that we have good results with a tuned model, we may want to simplify the model.  If we can simplify the model without significantly impacting accuracy, that's good for many reasons.</p>
<ol>
<li>The model is easier to understand</li>
<li>Fewer variables means fewer data quality issues and more focused data quality efforts</li>
<li>It takes less resources and time to run</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Feature-Importance">
<a class="anchor" href="#Feature-Importance" aria-hidden="true"><span class="octicon octicon-link"></span></a>Feature Importance<a class="anchor-link" href="#Feature-Importance"> </a>
</h3>
<p>There are my ways to measure importance.  How often do we use a feature to split?  How high up in the tree is it used to split?  We are going to use scikit learns feature importance information.</p>
<p>Let's look at what features are!</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse </span>
<span class="k">def</span> <span class="nf">rf_feat_importance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'cols'</span><span class="p">:</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s1">'imp'</span><span class="p">:</span><span class="n">m</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">}</span>
                       <span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'imp'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fi</span> <span class="o">=</span> <span class="n">rf_feat_importance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">xs</span><span class="p">)</span>
<span class="n">fi</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cols</th>
      <th>imp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>13</td>
      <td>fare</td>
      <td>0.209353</td>
    </tr>
    <tr>
      <td>10</td>
      <td>age</td>
      <td>0.178731</td>
    </tr>
    <tr>
      <td>4</td>
      <td>adult_male</td>
      <td>0.140225</td>
    </tr>
    <tr>
      <td>0</td>
      <td>sex</td>
      <td>0.092039</td>
    </tr>
    <tr>
      <td>3</td>
      <td>who</td>
      <td>0.079811</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">plot_fi</span><span class="p">(</span><span class="n">fi</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">fi</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">'cols'</span><span class="p">,</span> <span class="s1">'imp'</span><span class="p">,</span> <span class="s1">'barh'</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plot_fi</span><span class="p">(</span><span class="n">fi</span><span class="p">[:</span><span class="mi">30</span><span class="p">]);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Remove-Low-Important-Variables">
<a class="anchor" href="#Remove-Low-Important-Variables" aria-hidden="true"><span class="octicon octicon-link"></span></a>Remove Low Important Variables<a class="anchor-link" href="#Remove-Low-Important-Variables"> </a>
</h3>
<p>This isn't strictly neccesarry, but it is nice to simplify models if you can.  Simpler models are easier to understand and maintain, and they take less resources to run.  It is also interesting to know just how many variables are needed to predict.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to_keep</span> <span class="o">=</span> <span class="n">fi</span><span class="p">[</span><span class="n">fi</span><span class="o">.</span><span class="n">imp</span><span class="o">&gt;</span><span class="mf">0.05</span><span class="p">]</span><span class="o">.</span><span class="n">cols</span>
<span class="nb">len</span><span class="p">(</span><span class="n">to_keep</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>7</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xs_imp</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="n">to_keep</span><span class="p">]</span>
<span class="n">valid_xs_imp</span> <span class="o">=</span> <span class="n">valid_xs</span><span class="p">[</span><span class="n">to_keep</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clf</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">RandomForestClassifier</span><span class="p">(),</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">xs_imp</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/Users/isaac.flath/opt/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:1978: FutureWarning: The default value of cv will change from 3 to 5 in version 0.22. Specify it explicitly to silence this warning.
  warnings.warn(CV_WARNING, FutureWarning)
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>GridSearchCV(cv='warn', error_score='raise-deprecating',
             estimator=RandomForestClassifier(bootstrap=True, class_weight=None,
                                              criterion='gini', max_depth=None,
                                              max_features='auto',
                                              max_leaf_nodes=None,
                                              min_impurity_decrease=0.0,
                                              min_impurity_split=None,
                                              min_samples_leaf=1,
                                              min_samples_split=2,
                                              min_weight_fraction_leaf=0.0,
                                              n_estimators='warn', n_jobs=None,
                                              oob_score=False,
                                              random_state=None, verbose=0,
                                              warm_start=False),
             iid='warn', n_jobs=-1,
             param_grid={'max_depth': range(10, 20, 20),
                         'max_features': ['auto', 'log2'],
                         'min_samples_split': range(2, 20),
                         'n_estimators': range(10, 20, 20)},
             pre_dispatch='2*n_jobs', refit=True, return_train_score=False,
             scoring=None, verbose=0)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Results">
<a class="anchor" href="#Results" aria-hidden="true"><span class="octicon octicon-link"></span></a>Results<a class="anchor-link" href="#Results"> </a>
</h3>
<p>Now we see with only 6 features we still get pretty good results on on validation set.</p>
<p>Now the question is whether this small loss in accuracy outweighed by a simpler and more efficient model?  That's is a business question more than it is a data science question.</p>
<p>If you are detecting COVID-19, you probably want it to be as accurate as possible.  If you are going to predict whether someone is a cat or a dog person based on a survey for marketing purposes, small changes in accuracy probably are not as critical.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">clf</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">xs_imp</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[417,  25],
       [ 55, 213]])</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">valid_y</span><span class="p">,</span><span class="n">clf</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">valid_xs_imp</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[96, 11],
       [33, 41]])</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clf</span><span class="o">.</span><span class="n">best_estimator_</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>RandomForestClassifier(bootstrap=True, class_weight=None, criterion='gini',
                       max_depth=10, max_features='auto', max_leaf_nodes=None,
                       min_impurity_decrease=0.0, min_impurity_split=None,
                       min_samples_leaf=1, min_samples_split=11,
                       min_weight_fraction_leaf=0.0, n_estimators=10,
                       n_jobs=None, oob_score=False, random_state=None,
                       verbose=0, warm_start=False)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Redundant-columns">
<a class="anchor" href="#Redundant-columns" aria-hidden="true"><span class="octicon octicon-link"></span></a>Redundant columns<a class="anchor-link" href="#Redundant-columns"> </a>
</h3>
<p>Of the 6 remaining variables, we can see that some of them are very related.  It makes sense to me that deck and fare are related.  Nicer areas probably cost more.  It makes sense to me that the perons sex has some redudancy with adult_male - the redundancy is even in the name.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse</span>
<span class="k">def</span> <span class="nf">cluster_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
    <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">spearmanr</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">correlation</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">corr_condensed</span> <span class="o">=</span> <span class="n">hc</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">squareform</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">corr</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">hc</span><span class="o">.</span><span class="n">linkage</span><span class="p">(</span><span class="n">corr_condensed</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">'average'</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">hc</span><span class="o">.</span><span class="n">dendrogram</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">'left'</span><span class="p">,</span> <span class="n">leaf_font_size</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cluster_columns</span><span class="p">(</span><span class="n">xs_imp</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's expirament with removing some columns and see what we get.  We will use accuracy for our metric.</p>
<p>Here is out baseline:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"accuracy: "</span><span class="p">)</span>
<span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">valid_y</span><span class="p">,</span><span class="n">clf</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">valid_xs_imp</span><span class="p">))[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>\
    <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">valid_y</span><span class="p">,</span><span class="n">clf</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">valid_xs_imp</span><span class="p">))[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span><span class="o">/</span>\
    <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">valid_y</span><span class="p">,</span><span class="n">clf</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">valid_xs_imp</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>accuracy: 
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.7569060773480663</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse</span>
<span class="k">def</span> <span class="nf">get_accuracy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">valid_x</span><span class="p">,</span><span class="n">valid_y</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">bootstrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s1">'gini'</span><span class="p">,</span>
                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">,</span> <span class="n">max_leaf_nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">min_impurity_decrease</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">min_impurity_split</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                       <span class="n">min_weight_fraction_leaf</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                       <span class="n">n_jobs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">oob_score</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">xs_imp</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">((</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">valid_y</span><span class="p">,</span><span class="n">m</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">valid_xs_imp</span><span class="p">))[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>\
    <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">valid_y</span><span class="p">,</span><span class="n">m</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">valid_xs_imp</span><span class="p">))[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span><span class="o">/</span>\
    <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">valid_y</span><span class="p">,</span><span class="n">m</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">valid_xs_imp</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will now loop through each of the remaining variables and train a model and print out the accuracy score.</p>
<p>Judging by the scores below, removing any 1 variable does not significantly reduce the accuracy.  This means that we have redundant columns that can likely be trimmed.</p>
<p>From this we can remove variables and iterate through to continue simplifying as much as possible.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'sex'</span><span class="p">,</span><span class="s1">'adult_male'</span><span class="p">,</span><span class="s1">'pclass'</span><span class="p">,</span><span class="s1">'who'</span><span class="p">,</span><span class="s1">'age'</span><span class="p">,</span><span class="s1">'deck'</span><span class="p">,</span><span class="s1">'fare'</span><span class="p">]</span>

<span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'drop '</span><span class="o">+</span><span class="n">variable</span><span class="o">+</span><span class="s1">' accuracy:'</span><span class="p">)</span>
    <span class="n">get_accuracy</span><span class="p">(</span><span class="n">xs_imp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                 <span class="n">y</span><span class="p">,</span>
                 <span class="n">valid_xs_imp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                 <span class="n">valid_y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>drop sex accuracy:
0.8232044198895028
drop adult_male accuracy:
0.7900552486187845
drop pclass accuracy:
0.7955801104972375
drop who accuracy:
0.8011049723756906
drop age accuracy:
0.7955801104972375
drop deck accuracy:
0.7955801104972375
drop fare accuracy:
0.7845303867403315
</pre>
</div>
</div>

</div>
</div>

</div>
    

</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="Isaac-Flath/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/randomforest/classification/2020/05/07/RandomForestClassifier.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>A place for Isaac to write blog posts on things that interest him or those that he talks to.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/Isaac-Flath" title="Isaac-Flath"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/IsaacFlath" title="IsaacFlath"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
